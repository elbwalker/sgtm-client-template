<!DOCTYPE html>
<html lang="de">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1252" />
    <title>DEMO: using walker.js sGTM client</title>
    <script 
      async="" 
      data-endpoint="https://httpbin.org/anything" 
      src="walker-init.js">
    </script>
    <!--
    NOTE: YOU COULD LOAD A LOCAL FIRST PARTY COPY OF WALKER.JS OR EXTERNAL ONE LIKE THIS:
    <script async src="/walker.js"></script>
    -->
    <script async="" src="https://cdn.jsdelivr.net/npm/@elbwalker/walker.js@latest/dist/walker.js"></script>

    <style>
      body {
        font-family: arial;
        color: #fff;
        line-height: 1.4em;
        background: #222;
        text-align: center;
      }
      #cnt {
        position: relative;
        max-width: 1000px;
        margin: 10px auto;
        text-align: left;
        padding: 1em;
      }
      a,
      h1,
      h2,
      h3,
      h4 {
        color: #beffb7;
      }
      div[data-elb="call_to_action"] {
        padding: 2em;
        background: #333;
      }
    </style>
  </head>
  <body>
    <div id="cnt">
      <div data-elbglobals="language:de"></div>
      <div data-elbcontext="some_property:42">
        <h1><small>walker.js + sGTM</small></h1>
        <small>
          <p>
            Open console to see all events that are generated by walker.js. All
            hits are sent to a custom endpoint. No external ressources linked:
            find tracking initialization code in
            <a target="_blank" href="walker-init.js">walker-init.js</a
            >
            to see how it works. A (simple) example for client id and session
            handling can be found there as well. It demonstrates how to to
            collect events that can populate a GA4 property.
          </p>

          <h2>About Consent</h2>
          <div>
            <p>Current consent choice: <span id="consent_state"></span></p>
            <button onclick="consentAccept();">Accept</button>
            <button onclick="consentDeny();">Deny</button>
            <button onclick="consentReset();">Reset</button>
            <script></script>
          </div>
          <p>
            This example simulates a basic CMPs functionality and uses
            localStorage and sessionStorage to persist client id, session id and
            a session counter. You can see consistent values for session and
            device in the
            <em>user</em> array plus session information in the
            <em>globals</em> when you reload this page. In order to simulate
            missing consent, add a parameter <em>noconsent</em> to the url of
            this page (<a target="_blank" href="?noconsent">open page with strict opt-out</a
            >
            in separate tab). There will be no data transfer in general.
          </p>

          <p>
            <b>NOTE:</b> there are comments on how to handle consent and forwand
            it to sGTM in the script code. The client template in sGTM allows
            you to use different ways to control session and user data.
          </p>

          <h2>Some Links</h2>
          <ul>
            <li>
              send event via attribute:
              <a
                data-elb="helloworld"
                data-elbaction="click"
                href="#"
                >hello world!</a
              >
            </li>
            <li>
              send virtual "page view" using JavaScript:
              <a
                href="#"
                onclick="elb('page view', { id: '/test/virtual/path1', title: 'Virtual Page 1'}, 'click', {some_property: 14} );"
                >elb('page view', ...)</a
              >
            </li>
            <li>
              e-commerce: send "order complete" as "purchase" to GA4 (see code):
              <a
                href="#"
                onclick="sendPurchase(); return false;"
                >send purchase</a
              >
            </li>
          </ul>
          <p style="margin-bottom: 100%">
            scroll down to show demo promo element with visibility event...
          </p>

          <div data-elb="someblock" data-elbaction="visible">
            <h2 data-elb-someblock="name:#innerText">
              this is a promo block example
            </h2>
            <p data-elb-someblock="category:internal promo">
              Call! To! Action!
            </p>
          </div>
        </small>
      </div>
      <small> <!--elbcontext --> </small>
    </div>
    <small>
      <!--cnt -->

      <script>
        /**
         * send a purchase. Uses structure from the example at
         * https://www.elbwalker.com/gallery/orderSummary with some changes:
         * - all property names fit the GA4 e-commerce scheme at
         *   https://developers.google.com/analytics/devguides/collection/ga4/ecommerce
         * - an "event_name" parameter is added to the context object in order to overwrite
         *   the elbwalker event name. That could also be achieved by using the event name
         *   translation option in the sGTM client.
         */
        function sendPurchase() {
          elb(
            "order complete",
            {
              transaction_id: "0rd3r1d",
              net_value: 72,
              currency: "EUR",
              shipping: 8,
              tax: 6.4,
              value: 86.4,
            },
            "click",
            { event_name: "purchase" },
            [
              {
                type: "product",
                data: {
                  item_name: "Everyday Ruck Snack",
                  item_id: "sample01",
                  item_variant: "black",
                  quantity: 1,
                  price: 220,
                  currency: "EUR",
                },
              },
              {
                type: "product",
                data: {
                  item_name: "Cool Cap",
                  item_id: "sample02",
                  item_variant: "green",
                  quantity: 1,
                  price: 39,
                  currency: "EUR",
                },
              },
            ]
          );
        }
      </script>
    </small>
  </body>
</html>
